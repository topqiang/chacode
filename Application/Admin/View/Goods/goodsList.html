<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>后台管理系统</title>
	<link rel="stylesheet" href="__WEBPUBLIC__/Admin/css/reset.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="__WEBPUBLIC__/Admin/css/style.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="__WEBPUBLIC__/Admin/css/invalid.css" type="text/css" media="screen" />
	<script type="text/javascript" src="__WEBPUBLIC__/Admin/js/jquery-1.9.1.min.js"></script>
</head>
<body>
<div id="main-content">
	<div class="content-box">
		<!--头部切换-->
		<div class="content-box-header">
			<h3>商品列表</h3>
			<ul class="content-box-tabs">
				<li><a href="{:U('Goods/goodsList')}" class="default-tab current">商品列表</a></li>
				<li><a href="{:U('Goods/goodsAdd')}">添加商品</a></li>
			</ul>
			<div class="clear"></div>
		</div>

		<div class="content-search" style="height: 40px;margin: 10px 0 0 10px;">
			<form action="{:U('Goods/goodsList')}" method="post">
				商品名称：<input type="text" name="name" class="text-input">
				<input type="submit" class="button search-btn" value="查询">
			</form>
		</div>
		
		<!--表格内容-->
		<div class="content-box-content">
			<div class="tab-content default-tab" id="tab1">
				<form action="{:U('AdminBasic/delList',array('tname'=>'Good'))}" method="post">
					<table border="1">
						<!--标题-->
						<thead>
						<tr>
							<th width="5%">
								<input class="check-all" type="checkbox" />
								ID
							</th>
							<th width="15%">商品名称</th>
							<th width="10%">缩略图</th>
							<th width="20%">生成时间</th>
							<th width="20%">厂家名称</th>
							<th width="20%">批次</th>
							<th width="10%">操作</th>
						</tr>
						</thead>
						<!--内容-->
						<tbody>
						<if condition="empty($list)">
							<tr><td colspan="10">没有符合条件的结果</td></tr>
						</if>
						<volist name="list" id="vo">
							<tr>
								<td>
									<input type="checkbox" name="id[]" value="{$vo['gid']}"/>
									{$vo.id}
								</td>
								<td>
									{$vo.name}
								</td>
								<td><img src="__WEBROOT__/{$vo.pic}" height="30" /></td>
								<td>{$vo.ctime|date="y-m-d H:m:i",###}</td>
								<td>{$vo.company}</td>
								<td>{$vo.creatcode}</td>
                                <td>
                                	<a id="{$vo['id']}" class="creatcode" title="生成防伪码">
                                        <img src="__WEBPUBLIC__/Admin/images/icons/code.png" alt="生成防伪码" />
                                    </a>
                                    <a href="{:U('Goods/goodsEdit',array('id'=>$vo['id']))}" title="编辑">
                                        <img src="__WEBPUBLIC__/Admin/images/icons/pencil.png" alt="Edit" />
                                    </a>
                                    <a href="{:U('Goods/goodsDel',array('id'=>$vo['id']))}" title="删除">
                                        <img src="__WEBPUBLIC__/Admin/images/icons/cross.png" alt="Delete" />
                                    </a>
								</td>
							</tr>
						</volist>
						<!--表尾-->
						</tbody>
						<tfoot>
						<tr>
							<td colspan="20">
								<div class="bulk-actions align-left">
									<input type="submit" value="批量删除" class="button"/>
								</div>
								<div class="pagination">
									{$page}
								</div>
								<div class="clear"></div>
							</td>
						</tr>
						</tfoot>
					</table>
				</form>
			</div>
		</div>
	</div>
</div>
<div id="sou" style="text-align:center;display:none;">
	<div style="padding:20px;">
		<div><input type="text" class="codenum" placeholder="请输入防伪码"/></div>
	</div>
</div>
<div id="imgcode" style="text-align:center;display:none;">
	<div style="padding:20px;">
		<img id="codeimg" style="width:100%;"/>
	</div>
</div>
</body>
<script type="text/javascript" src="__WEBPUBLIC__/Admin/js/layer/layer.js"></script>
<script type="text/javascript">

	$(".creatcode").on('click',function(){
		var id = $(this).attr("id");
		var index = layer.open({
			type:1,
			title: '请输入防伪码',
			btn: ['生成'],
			yes: function () {
				var keywords = $(".codenum").val();
				if (keywords) {
					$.ajax({
						"url":"{:U('Admin/Goods/qrcode')}",
						"type":"post",
						"data":{"id":id,"codenum":keywords},
						"dataType":"json",
						"success":function ( res ) {
							if (res.flag == "success") {
								$("#codeimg").attr("src","__ROOT__"+res.data.code_pic);
								layer.close(index);
								layer.open({
									type:1,
									title:"右键另存为吧！",
									content: $('#imgcode'),
									area:["400px",""]
								});
							}else{
								alert(res.message);
							}
						}
					});
				}else{
					alert("关键词为空！");
				}
			},
			content: $('#sou'),
			area:["200px","auto"]
		});  
	});
</script>
</html>
